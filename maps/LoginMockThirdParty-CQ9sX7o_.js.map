{"version":3,"file":"LoginMockThirdParty-CQ9sX7o_.js","sources":["../../node_modules/.pnpm/ahooks@3.7.11_react@18.2.0/node_modules/ahooks/es/useLocalStorageState/index.js","../../node_modules/.pnpm/ahooks@3.7.11_react@18.2.0/node_modules/ahooks/es/createUseStorageState/index.js","../../src/features/LoginMockThirdParty.tsx"],"sourcesContent":["import { createUseStorageState } from '../createUseStorageState';\nimport isBrowser from '../utils/isBrowser';\nvar useLocalStorageState = createUseStorageState(function () {\n  return isBrowser ? localStorage : undefined;\n});\nexport default useLocalStorageState;","import { __read } from \"tslib\";\nimport { useState } from 'react';\nimport useMemoizedFn from '../useMemoizedFn';\nimport useUpdateEffect from '../useUpdateEffect';\nimport { isFunction, isUndef } from '../utils';\nexport function createUseStorageState(getStorage) {\n  function useStorageState(key, options) {\n    if (options === void 0) {\n      options = {};\n    }\n    var storage;\n    var _a = options.onError,\n      onError = _a === void 0 ? function (e) {\n        console.error(e);\n      } : _a;\n    // https://github.com/alibaba/hooks/issues/800\n    try {\n      storage = getStorage();\n    } catch (err) {\n      onError(err);\n    }\n    var serializer = function (value) {\n      if (options.serializer) {\n        return options.serializer(value);\n      }\n      return JSON.stringify(value);\n    };\n    var deserializer = function (value) {\n      if (options.deserializer) {\n        return options.deserializer(value);\n      }\n      return JSON.parse(value);\n    };\n    function getStoredValue() {\n      try {\n        var raw = storage === null || storage === void 0 ? void 0 : storage.getItem(key);\n        if (raw) {\n          return deserializer(raw);\n        }\n      } catch (e) {\n        onError(e);\n      }\n      if (isFunction(options.defaultValue)) {\n        return options.defaultValue();\n      }\n      return options.defaultValue;\n    }\n    var _b = __read(useState(getStoredValue), 2),\n      state = _b[0],\n      setState = _b[1];\n    useUpdateEffect(function () {\n      setState(getStoredValue());\n    }, [key]);\n    var updateState = function (value) {\n      var currentState = isFunction(value) ? value(state) : value;\n      setState(currentState);\n      if (isUndef(currentState)) {\n        storage === null || storage === void 0 ? void 0 : storage.removeItem(key);\n      } else {\n        try {\n          storage === null || storage === void 0 ? void 0 : storage.setItem(key, serializer(currentState));\n        } catch (e) {\n          console.error(e);\n        }\n      }\n    };\n    return [state, useMemoizedFn(updateState)];\n  }\n  return useStorageState;\n}","import { useLocalStorageState } from 'ahooks'\nimport { Button, Card, Form, Input } from 'antd'\nimport CryptoJS from 'crypto-js'\nimport fb_toast from 'fb-components/base_ui/fb_toast'\nimport Cookies from 'js-cookie'\nimport md5 from 'md5'\nimport { useEffect, useState } from 'react'\nimport { useNavigate } from 'react-router-dom'\n\ninterface FormData {\n  account: string\n  username: string\n}\n\nexport default function LoginMockThirdParty() {\n  const [inputs, setInputs] = useLocalStorageState<FormData>('login_mock_third_party')\n  const [loading, setLoading] = useState(false)\n  const navigate = useNavigate()\n\n  useEffect(() => {\n    Cookies.remove('user')\n  }, [])\n\n  const onFinish = async (values: FormData) => {\n    setInputs(values)\n    setLoading(true)\n\n    const API_HOST = import.meta.env.FANBOOK_API_HOST\n    // 开发环境的 app_id 和 app_secret\n    const app_id = '4fdfc4e770d3998f87aae336c6e41f59'\n    const app_secret = '1711f4a92b0f2a7d6932295e41026e5a'\n\n    const timestamp = Math.floor(Date.now() / 1000)\n\n    const userInfo = {\n      user_id: values.account,\n      mobile: '17500000001',\n      nickname: values.username,\n      avatar: 'https://fb-cdn.fanbook.cn/fanbook/app/files/chatroom/image/2aaea904b1ffd54c613df20b70f0408e.jpg',\n      gender: 1,\n    }\n\n    const nonce = new Array(16)\n      .fill(0)\n      .map(() => Math.floor(Math.random() * 10))\n      .join('')\n    const { code } = await fetch(`${API_HOST}/openApi/third/code`, {\n      method: 'POST',\n      headers: {\n        'content-type': 'application/json',\n      },\n      body: JSON.stringify({\n        app_id,\n        app_secret,\n        nonce,\n        timestamp,\n        sign: md5(`${app_id}${app_secret}${nonce}${timestamp}`),\n      }),\n    })\n      .then(res => res.json())\n      .then(res => {\n        if (res.code !== 1000) {\n          fb_toast.open({ type: 'error', content: res.message })\n        }\n        return res.data\n      })\n    const sign = md5(`${app_id}${code}${nonce}${timestamp}`)\n    const auth = CryptoJS.AES.encrypt(JSON.stringify(userInfo), CryptoJS.enc.Utf8.parse(app_secret.slice(0, 16)), {\n      iv: CryptoJS.enc.Utf8.parse(nonce),\n      mode: CryptoJS.mode.CBC,\n      padding: CryptoJS.pad.Pkcs7,\n    }).toString()\n\n    setLoading(false)\n\n    navigate(\n      `/login?type=third-party&type=third-party&code=${code}&nonce=${nonce}&sign=${sign}&timestamp=${timestamp}&app_id=${app_id}&auth=${encodeURIComponent(auth)}`\n    )\n  }\n\n  return (\n    <Card className={'m-auto w-96 mt-[40%]'}>\n      <Form initialValues={inputs} onFinish={onFinish} className={'space-y-6'}>\n        <strong>此页面用于模拟第三方登录，仅供开发/测试环境使用</strong>\n        <Form.Item name={'account'} required rules={[{ required: true, message: '请输入账号' }]}>\n          <Input placeholder={'账号'} />\n        </Form.Item>\n        <Form.Item name={'username'} help={'如果账号不存在，会用此名字注册'} required rules={[{ required: true, message: '请输入用户名' }]}>\n          <Input placeholder={'用户名'} />\n        </Form.Item>\n        <Button type={'primary'} size={'large'} className={'w-full'} htmlType={'submit'} loading={loading}>\n          跳转到登录\n        </Button>\n      </Form>\n    </Card>\n  )\n}\n"],"names":["getStorage","useLocalStorageState","isBrowser","localStorage","key","options","storage","_a","onError","e","console","error","err","getStoredValue","raw","getItem","value","deserializer","JSON","parse","isFunction","defaultValue","_b","__read","useState","state","setState","useUpdateEffect","useMemoizedFn","currentState","isUndef","removeItem","setItem","serializer","stringify","LoginMockThirdParty","inputs","setInputs","loading","setLoading","navigate","useNavigate","useEffect","Cookies","remove","jsx","Card","className","children","jsxs","Form","initialValues","onFinish","async","values","app_id","app_secret","timestamp","Math","floor","Date","now","userInfo","user_id","account","mobile","nickname","username","avatar","gender","nonce","Array","fill","map","random","join","code","fetch","method","headers","body","sign","md5","then","res","json","fb_toast","open","type","content","message","data","auth","CryptoJS","AES","encrypt","enc","Utf8","slice","iv","mode","CBC","padding","pad","Pkcs7","toString","encodeURIComponent","Item","name","required","rules","Input","placeholder","help","Button","size","htmlType"],"mappings":"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","x_google_ignoreList":[0,1]}